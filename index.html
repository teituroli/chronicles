<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Campaign Chronicle</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0b;
    --surface: #111114;
    --surface2: #18181d;
    --surface3: #1e1e25;
    --border: #2a2a35;
    --border2: #3a3a48;
    --accent: #e8ff47;
    --accent2: #7c6fff;
    --accent3: #ff6b6b;
    --text: #f0f0f5;
    --text2: #9090a8;
    --text3: #606075;
    --mono: 'DM Mono', monospace;
    --sans: 'DM Sans', sans-serif;
    --display: 'Syne', sans-serif;
    --radius: 6px;
    --sidebar-w: 220px;
    --transition: 0.15s ease;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--sans);
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    font-size: 14px;
    line-height: 1.6;
  }

  /* ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ */
  #topbar {
    height: 52px;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 20px;
    gap: 16px;
    flex-shrink: 0;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  #logo {
    font-family: var(--display);
    font-weight: 800;
    font-size: 16px;
    color: var(--accent);
    letter-spacing: -0.5px;
    white-space: nowrap;
  }

  #logo span { color: var(--text3); font-weight: 400; }

  #campaign-selector {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: auto;
  }

  #campaign-select {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--sans);
    font-size: 13px;
    padding: 5px 10px;
    border-radius: var(--radius);
    cursor: pointer;
    outline: none;
    max-width: 200px;
  }
  #campaign-select:focus { border-color: var(--accent2); }

  .btn {
    font-family: var(--sans);
    font-size: 12px;
    font-weight: 500;
    padding: 6px 12px;
    border-radius: var(--radius);
    border: none;
    cursor: pointer;
    transition: all var(--transition);
    white-space: nowrap;
    display: inline-flex;
    align-items: center;
    gap: 5px;
  }

  .btn-accent { background: var(--accent); color: #000; }
  .btn-accent:hover { background: #d4e83f; }
  .btn-ghost { background: transparent; color: var(--text2); border: 1px solid var(--border); }
  .btn-ghost:hover { border-color: var(--border2); color: var(--text); }
  .btn-danger { background: transparent; color: var(--accent3); border: 1px solid var(--accent3)22; }
  .btn-danger:hover { background: var(--accent3)22; }
  .btn-primary { background: var(--accent2); color: #fff; }
  .btn-primary:hover { background: #6a5ef0; }

  /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
  #app { display: flex; flex: 1; overflow: hidden; height: calc(100vh - 52px); }

  /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
  #sidebar {
    width: var(--sidebar-w);
    background: var(--surface);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    flex-shrink: 0;
  }

  .nav-section {
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
  }

  .nav-label {
    font-family: var(--mono);
    font-size: 10px;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 1.5px;
    padding: 8px 16px 4px;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 16px;
    cursor: pointer;
    transition: all var(--transition);
    color: var(--text2);
    font-size: 13px;
    border-left: 2px solid transparent;
    user-select: none;
  }

  .nav-item:hover { background: var(--surface2); color: var(--text); }
  .nav-item.active { background: var(--surface2); color: var(--accent); border-left-color: var(--accent); }
  .nav-icon { font-size: 14px; width: 16px; text-align: center; }

  /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
  #main {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }

  .page { display: none; flex-direction: column; flex: 1; }
  .page.active { display: flex; }

  .page-header {
    padding: 28px 32px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: flex-start;
    gap: 16px;
    justify-content: space-between;
  }

  .page-title {
    font-family: var(--display);
    font-size: 22px;
    font-weight: 700;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .page-sub { color: var(--text3); font-size: 12px; margin-top: 2px; font-family: var(--mono); }

  .page-body { padding: 24px 32px; flex: 1; }

  /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
  .card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 16px;
  }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    transition: border-color var(--transition);
    position: relative;
  }

  .card:hover { border-color: var(--border2); }

  .card-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
  }

  .card-title {
    font-family: var(--display);
    font-weight: 600;
    font-size: 15px;
    color: var(--text);
  }

  .card-meta { font-size: 11px; color: var(--text3); font-family: var(--mono); margin-top: 3px; }

  .card-body { color: var(--text2); font-size: 13px; line-height: 1.6; }

  .card-actions {
    display: flex;
    gap: 6px;
    margin-top: 14px;
    padding-top: 12px;
    border-top: 1px solid var(--border);
  }

  .badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 100px;
    font-size: 10px;
    font-family: var(--mono);
    font-weight: 500;
    letter-spacing: 0.5px;
  }

  .badge-yellow { background: var(--accent)22; color: var(--accent); }
  .badge-purple { background: var(--accent2)22; color: var(--accent2); }
  .badge-red { background: var(--accent3)22; color: var(--accent3); }
  .badge-green { background: #47ff8722; color: #47ff87; }
  .badge-gray { background: var(--surface3); color: var(--text3); }

  .tag {
    display: inline-block;
    padding: 1px 7px;
    background: var(--surface3);
    border: 1px solid var(--border);
    border-radius: 100px;
    font-size: 10px;
    font-family: var(--mono);
    color: var(--text3);
    margin: 2px;
  }

  /* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
  .empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 80px 20px;
    text-align: center;
    color: var(--text3);
    gap: 12px;
  }

  .empty-icon { font-size: 36px; opacity: 0.4; }
  .empty-title { font-family: var(--display); font-size: 16px; color: var(--text2); }
  .empty-sub { font-size: 12px; max-width: 280px; }

  /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: #000000cc;
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 20px;
    backdrop-filter: blur(4px);
  }

  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 10px;
    width: 100%;
    max-width: 680px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 32px 64px #00000088;
  }

  .modal-header {
    padding: 20px 24px 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    background: var(--surface);
    z-index: 1;
  }

  .modal-title { font-family: var(--display); font-weight: 700; font-size: 17px; }

  .modal-close {
    background: none;
    border: none;
    color: var(--text3);
    font-size: 20px;
    cursor: pointer;
    line-height: 1;
    padding: 4px;
    transition: color var(--transition);
  }
  .modal-close:hover { color: var(--text); }

  .modal-body { padding: 20px 24px; }
  .modal-footer {
    padding: 16px 24px;
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: flex-end;
    gap: 8px;
  }

  /* ‚îÄ‚îÄ FORM ‚îÄ‚îÄ */
  .form-grid { display: grid; gap: 16px; }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

  .form-group { display: flex; flex-direction: column; gap: 5px; }

  label {
    font-size: 11px;
    font-family: var(--mono);
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 0.8px;
  }

  input[type=text], input[type=number], textarea, select {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    color: var(--text);
    font-family: var(--sans);
    font-size: 13px;
    padding: 8px 12px;
    outline: none;
    transition: border-color var(--transition);
    width: 100%;
  }

  input:focus, textarea:focus, select:focus { border-color: var(--accent2); }

  textarea { resize: vertical; min-height: 80px; }

  select { cursor: pointer; }

  .section-title {
    font-family: var(--display);
    font-size: 12px;
    font-weight: 600;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 1px;
    border-bottom: 1px solid var(--border);
    padding-bottom: 8px;
    margin-bottom: 14px;
  }

  /* ‚îÄ‚îÄ TRUST STARS ‚îÄ‚îÄ */
  .trust-stars { display: flex; gap: 3px; }
  .star { color: var(--text3); font-size: 12px; }
  .star.filled { color: var(--accent); }

  /* ‚îÄ‚îÄ DETAIL VIEW ‚îÄ‚îÄ */
  .detail-section {
    margin-bottom: 20px;
  }

  .detail-label {
    font-family: var(--mono);
    font-size: 10px;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 6px;
  }

  .detail-value {
    color: var(--text2);
    font-size: 13px;
    line-height: 1.7;
    white-space: pre-wrap;
  }

  /* ‚îÄ‚îÄ SEARCH BAR ‚îÄ‚îÄ */
  .search-bar {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
  }

  .search-input {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    color: var(--text);
    font-family: var(--sans);
    font-size: 13px;
    padding: 7px 12px;
    outline: none;
    flex: 1;
    transition: border-color var(--transition);
  }
  .search-input:focus { border-color: var(--accent2); }

  /* ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ */
  .settings-block {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    margin-bottom: 16px;
  }

  .settings-block h3 {
    font-family: var(--display);
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 14px;
    color: var(--text);
  }

  /* ‚îÄ‚îÄ STATUS INDICATOR ‚îÄ‚îÄ */
  #sync-status {
    font-family: var(--mono);
    font-size: 11px;
    color: var(--text3);
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--text3);
  }
  .status-dot.ok { background: #47ff87; }
  .status-dot.err { background: var(--accent3); }
  .status-dot.loading {
    background: var(--accent);
    animation: pulse 1s infinite;
  }

  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

  /* ‚îÄ‚îÄ QUEST BOARD ‚îÄ‚îÄ */
  .quest-columns {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 16px;
  }

  .quest-column {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px;
  }

  .quest-column-title {
    font-family: var(--display);
    font-size: 12px;
    font-weight: 600;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .quest-item {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 10px 12px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: border-color var(--transition);
  }

  .quest-item:hover { border-color: var(--border2); }

  .quest-item-title {
    font-size: 13px;
    font-weight: 500;
    color: var(--text);
    margin-bottom: 4px;
  }

  /* ‚îÄ‚îÄ REPUTATION ‚îÄ‚îÄ */
  .rep-bar-wrap {
    margin-bottom: 12px;
  }

  .rep-bar-label {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: var(--text2);
    margin-bottom: 4px;
  }

  .rep-bar-bg {
    height: 6px;
    background: var(--surface3);
    border-radius: 100px;
    overflow: hidden;
  }

  .rep-bar-fill {
    height: 100%;
    border-radius: 100px;
    background: linear-gradient(90deg, var(--accent3), var(--accent));
    transition: width 0.4s ease;
  }

  /* ‚îÄ‚îÄ TIMELINE ‚îÄ‚îÄ */
  .timeline { position: relative; padding-left: 24px; }
  .timeline::before {
    content: '';
    position: absolute;
    left: 6px;
    top: 8px;
    bottom: 8px;
    width: 1px;
    background: var(--border);
  }

  .timeline-item {
    position: relative;
    margin-bottom: 20px;
  }

  .timeline-dot {
    position: absolute;
    left: -21px;
    top: 5px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent2);
    border: 2px solid var(--bg);
  }

  .timeline-date {
    font-family: var(--mono);
    font-size: 10px;
    color: var(--text3);
    margin-bottom: 3px;
  }

  .timeline-content {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px;
  }

  /* ‚îÄ‚îÄ NO CAMPAIGN ‚îÄ‚îÄ */
  #no-campaign {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex: 1;
    gap: 16px;
    text-align: center;
    padding: 40px;
  }

  #no-campaign h2 {
    font-family: var(--display);
    font-size: 20px;
    font-weight: 700;
  }

  #no-campaign p { color: var(--text3); font-size: 13px; max-width: 320px; }

  /* ‚îÄ‚îÄ QUOTE LOG ‚îÄ‚îÄ */
  .quote-item {
    border-left: 2px solid var(--accent2);
    padding: 8px 14px;
    margin-bottom: 10px;
    background: var(--surface);
    border-radius: 0 var(--radius) var(--radius) 0;
  }

  .quote-text { font-style: italic; color: var(--text2); font-size: 13px; }
  .quote-attr { font-family: var(--mono); font-size: 10px; color: var(--text3); margin-top: 4px; }

  /* ‚îÄ‚îÄ THEORY WEB ‚îÄ‚îÄ */
  .theory-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    border-radius: var(--radius);
    padding: 14px;
    margin-bottom: 12px;
  }

  .inventory-section {
    margin-bottom: 24px;
  }

  .inventory-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
  }

  .inventory-table th {
    font-family: var(--mono);
    font-size: 10px;
    text-transform: uppercase;
    color: var(--text3);
    letter-spacing: 0.8px;
    padding: 6px 10px;
    text-align: left;
    border-bottom: 1px solid var(--border);
  }

  .inventory-table td {
    padding: 8px 10px;
    border-bottom: 1px solid var(--border);
    color: var(--text2);
  }

  .inventory-table tr:last-child td { border-bottom: none; }
  .inventory-table tr:hover td { background: var(--surface2); color: var(--text); }

  /* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
  ::-webkit-scrollbar { width: 5px; height: 5px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 10px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--text3); }
</style>
</head>
<body>

<!-- TOP BAR -->
<div id="topbar">
  <div id="logo">Chronicle <span>/ TTRPG</span></div>
  <div id="sync-status">
    <div class="status-dot" id="sync-dot"></div>
    <span id="sync-text">Not connected</span>
  </div>
  <div id="campaign-selector">
    <select id="campaign-select"><option value="">‚Äî Select Campaign ‚Äî</option></select>
    <button class="btn btn-ghost" onclick="openNewCampaignModal()">+ Campaign</button>
    <button class="btn btn-ghost" onclick="showPage('settings')">‚öô</button>
  </div>
</div>

<!-- APP -->
<div id="app">
  <!-- SIDEBAR -->
  <nav id="sidebar">
    <div class="nav-section">
      <div class="nav-label">Chapters</div>
      <div class="nav-item active" data-page="sessions" onclick="showPage('sessions')">
        <span class="nav-icon">üìñ</span> Sessions
      </div>
      <div class="nav-item" data-page="npcs" onclick="showPage('npcs')">
        <span class="nav-icon">üë•</span> NPCs
      </div>
      <div class="nav-item" data-page="creatures" onclick="showPage('creatures')">
        <span class="nav-icon">üëπ</span> Bestiary
      </div>
      <div class="nav-item" data-page="locations" onclick="showPage('locations')">
        <span class="nav-icon">üó∫Ô∏è</span> Locations
      </div>
      <div class="nav-item" data-page="quests" onclick="showPage('quests')">
        <span class="nav-icon">üéØ</span> Quests
      </div>
      <div class="nav-item" data-page="inventory" onclick="showPage('inventory')">
        <span class="nav-icon">üéí</span> Inventory
      </div>
    </div>
    <div class="nav-section">
      <div class="nav-label">Meta</div>
      <div class="nav-item" data-page="theories" onclick="showPage('theories')">
        <span class="nav-icon">üß†</span> Theories
      </div>
      <div class="nav-item" data-page="party" onclick="showPage('party')">
        <span class="nav-icon">üé≠</span> Party Web
      </div>
      <div class="nav-item" data-page="memory" onclick="showPage('memory')">
        <span class="nav-icon">üî•</span> Memory Log
      </div>
      <div class="nav-item" data-page="reputation" onclick="showPage('reputation')">
        <span class="nav-icon">üîÑ</span> Reputation
      </div>
    </div>
    <div class="nav-section">
      <div class="nav-label">System</div>
      <div class="nav-item" data-page="settings" onclick="showPage('settings')">
        <span class="nav-icon">‚öôÔ∏è</span> Settings
      </div>
    </div>
  </nav>

  <!-- MAIN -->
  <main id="main">
    <!-- NO CAMPAIGN -->
    <div id="no-campaign" style="display:none;">
      <div style="font-size:48px;opacity:0.3">üìñ</div>
      <h2>No Campaign Selected</h2>
      <p>Select a campaign from the top bar or create a new one to begin.</p>
      <button class="btn btn-accent" onclick="openNewCampaignModal()">+ New Campaign</button>
    </div>

    <!-- SESSIONS PAGE -->
    <div class="page active" id="page-sessions">
      <div class="page-header">
        <div>
          <div class="page-title">üìñ Session Chronicle</div>
          <div class="page-sub">The heart of the campaign</div>
        </div>
        <button class="btn btn-accent" onclick="openSessionModal()">+ New Session</button>
      </div>
      <div class="page-body">
        <div class="search-bar">
          <input class="search-input" placeholder="Search sessions..." oninput="filterSessions(this.value)">
        </div>
        <div id="sessions-list" class="card-grid"></div>
      </div>
    </div>

    <!-- NPCS PAGE -->
    <div class="page" id="page-npcs">
      <div class="page-header">
        <div>
          <div class="page-title">üë• NPC Tracker</div>
          <div class="page-sub">Know everyone, trust no one</div>
        </div>
        <button class="btn btn-accent" onclick="openNPCModal()">+ Add NPC</button>
      </div>
      <div class="page-body">
        <div class="search-bar">
          <input class="search-input" placeholder="Search NPCs..." oninput="filterNPCs(this.value)">
          <select id="npc-filter-align" style="width:auto;flex-shrink:0" onchange="filterNPCs(document.querySelector('#page-npcs .search-input').value)">
            <option value="">All alignments</option>
            <option value="Ally">Ally</option>
            <option value="Neutral">Neutral</option>
            <option value="Rival">Rival</option>
            <option value="Threat">Threat</option>
            <option value="Unknown">Unknown</option>
          </select>
        </div>
        <div id="npcs-list" class="card-grid"></div>
      </div>
    </div>

    <!-- CREATURES PAGE -->
    <div class="page" id="page-creatures">
      <div class="page-header">
        <div>
          <div class="page-title">üëπ Bestiary</div>
          <div class="page-sub">Field journal of encountered creatures</div>
        </div>
        <button class="btn btn-accent" onclick="openCreatureModal()">+ Add Creature</button>
      </div>
      <div class="page-body">
        <div class="search-bar">
          <input class="search-input" placeholder="Search creatures..." oninput="filterCreatures(this.value)">
        </div>
        <div id="creatures-list" class="card-grid"></div>
      </div>
    </div>

    <!-- LOCATIONS PAGE -->
    <div class="page" id="page-locations">
      <div class="page-header">
        <div>
          <div class="page-title">üó∫Ô∏è Location Journal</div>
          <div class="page-sub">Places visited, changed, haunted</div>
        </div>
        <button class="btn btn-accent" onclick="openLocationModal()">+ Add Location</button>
      </div>
      <div class="page-body">
        <div class="search-bar">
          <input class="search-input" placeholder="Search locations..." oninput="filterLocations(this.value)">
        </div>
        <div id="locations-list" class="card-grid"></div>
      </div>
    </div>

    <!-- QUESTS PAGE -->
    <div class="page" id="page-quests">
      <div class="page-header">
        <div>
          <div class="page-title">üéØ Quest Board</div>
          <div class="page-sub">Goals, leads, and loose ends</div>
        </div>
        <button class="btn btn-accent" onclick="openQuestModal()">+ Add Quest</button>
      </div>
      <div class="page-body">
        <div id="quests-board" class="quest-columns"></div>
      </div>
    </div>

    <!-- INVENTORY PAGE -->
    <div class="page" id="page-inventory">
      <div class="page-header">
        <div>
          <div class="page-title">üéí Party Inventory</div>
          <div class="page-sub">Shared loot and carried items</div>
        </div>
        <button class="btn btn-accent" onclick="openItemModal()">+ Add Item</button>
      </div>
      <div class="page-body" id="inventory-body"></div>
    </div>

    <!-- THEORIES PAGE -->
    <div class="page" id="page-theories">
      <div class="page-header">
        <div>
          <div class="page-title">üß† Theory Board</div>
          <div class="page-sub">Conspiracies, guesses, and speculation</div>
        </div>
        <button class="btn btn-accent" onclick="openTheoryModal()">+ Add Theory</button>
      </div>
      <div class="page-body">
        <div id="theories-list"></div>
      </div>
    </div>

    <!-- PARTY PAGE -->
    <div class="page" id="page-party">
      <div class="page-header">
        <div>
          <div class="page-title">üé≠ Party Web</div>
          <div class="page-sub">Relationships, bonds, and secrets</div>
        </div>
        <button class="btn btn-accent" onclick="openPartyModal()">+ Add Relationship</button>
      </div>
      <div class="page-body">
        <div id="party-list" class="card-grid"></div>
      </div>
    </div>

    <!-- MEMORY PAGE -->
    <div class="page" id="page-memory">
      <div class="page-header">
        <div>
          <div class="page-title">üî• Memory Log</div>
          <div class="page-sub">Quotes, crits, deaths, and legends</div>
        </div>
        <button class="btn btn-accent" onclick="openMemoryModal()">+ Add Entry</button>
      </div>
      <div class="page-body">
        <div id="memory-list"></div>
      </div>
    </div>

    <!-- REPUTATION PAGE -->
    <div class="page" id="page-reputation">
      <div class="page-header">
        <div>
          <div class="page-title">üîÑ Reputation Tracker</div>
          <div class="page-sub">How factions see the party</div>
        </div>
        <button class="btn btn-accent" onclick="openReputationModal()">+ Add Faction</button>
      </div>
      <div class="page-body">
        <div id="reputation-list"></div>
      </div>
    </div>

    <!-- SETTINGS PAGE -->
    <div class="page" id="page-settings">
      <div class="page-header">
        <div>
          <div class="page-title">‚öôÔ∏è Settings</div>
          <div class="page-sub">GitHub storage configuration</div>
        </div>
      </div>
      <div class="page-body">
        <div class="settings-block">
          <h3>GitHub Storage</h3>
          <div class="form-grid">
            <div class="form-row">
              <div class="form-group">
                <label>Owner / Username</label>
                <input type="text" id="s-owner" placeholder="teituroli">
              </div>
              <div class="form-group">
                <label>Repository</label>
                <input type="text" id="s-repo" placeholder="campaign-data">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Branch</label>
                <input type="text" id="s-branch" placeholder="main">
              </div>
              <div class="form-group">
                <label>Personal Access Token</label>
                <input type="text" id="s-token" placeholder="ghp_...">
              </div>
            </div>
            <button class="btn btn-accent" onclick="saveSettings()" style="width:fit-content">Save & Test Connection</button>
          </div>
        </div>
        <div class="settings-block">
          <h3>Data Management</h3>
          <p style="color:var(--text3);font-size:13px;margin-bottom:12px">Data is stored as JSON files in your GitHub repo. Each campaign gets its own folder.</p>
          <button class="btn btn-ghost" onclick="forceSyncAll()">‚Üª Force Re-sync</button>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- NEW CAMPAIGN MODAL -->
<div class="modal-overlay" id="modal-campaign">
  <div class="modal" style="max-width:420px">
    <div class="modal-header">
      <div class="modal-title">New Campaign</div>
      <button class="modal-close" onclick="closeModal('modal-campaign')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label>Campaign Name</label>
          <input type="text" id="c-name" placeholder="e.g. Curse of Strahd">
        </div>
        <div class="form-group">
          <label>System</label>
          <input type="text" id="c-system" placeholder="D&D 5e, Pathfinder, Call of Cthulhu‚Ä¶">
        </div>
        <div class="form-group">
          <label>Party Members (comma-separated)</label>
          <input type="text" id="c-party" placeholder="Aragorn, Gimli, Legolas">
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea id="c-desc" placeholder="A short blurb about the campaign‚Ä¶"></textarea>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-campaign')">Cancel</button>
      <button class="btn btn-accent" onclick="createCampaign()">Create Campaign</button>
    </div>
  </div>
</div>

<!-- SESSION MODAL -->
<div class="modal-overlay" id="modal-session">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="session-modal-title">New Session</div>
      <button class="modal-close" onclick="closeModal('modal-session')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-row">
          <div class="form-group">
            <label>Session #</label>
            <input type="number" id="s-num" placeholder="1" min="1">
          </div>
          <div class="form-group">
            <label>In-Game Date</label>
            <input type="text" id="s-date" placeholder="15th of Harvestmoon, 1492">
          </div>
        </div>
        <div class="form-group">
          <label>Location(s)</label>
          <input type="text" id="s-location" placeholder="The Yawning Portal, Waterdeep">
        </div>
        <div class="form-group">
          <label>Party Members Present</label>
          <input type="text" id="s-present" placeholder="Aragorn, Gimli">
        </div>
        <div class="form-group">
          <div class="section-title">üìù What Happened (Narrative)</div>
          <textarea id="s-narrative" placeholder="Story-style recap of the session‚Ä¶" style="min-height:100px"></textarea>
        </div>
        <div class="form-group">
          <div class="section-title">üß† Important Discoveries</div>
          <textarea id="s-discoveries" placeholder="Clues, lore drops, prophecies, maps‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <div class="section-title">üë• NPCs Met (quick notes)</div>
          <textarea id="s-npcs" placeholder="Name ‚Äî first impression, what they want‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <div class="section-title">üëπ Creatures Encountered</div>
          <textarea id="s-creatures" placeholder="Name/type, hostile/neutral, outcome‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <div class="section-title">üí∞ Loot & Items</div>
          <textarea id="s-loot" placeholder="What was found, who carries it‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <div class="section-title">‚ùì Unanswered Questions</div>
          <textarea id="s-questions" placeholder="Why did ___ happen? Who is ___ really?"></textarea>
        </div>
        <div class="form-group">
          <label>Tags (comma-separated)</label>
          <input type="text" id="s-tags" placeholder="#undead, #capital-city, #cult">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-session')">Cancel</button>
      <button class="btn btn-accent" onclick="saveSession()">Save Session</button>
    </div>
  </div>
</div>

<!-- NPC MODAL -->
<div class="modal-overlay" id="modal-npc">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="npc-modal-title">Add NPC</div>
      <button class="modal-close" onclick="closeModal('modal-npc')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-row">
          <div class="form-group">
            <label>Name</label>
            <input type="text" id="n-name" placeholder="Tasha Wavecrest">
          </div>
          <div class="form-group">
            <label>Location</label>
            <input type="text" id="n-location" placeholder="Where they reside">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Trust Level (1‚Äì5)</label>
            <select id="n-trust">
              <option value="1">1 ‚Äî Distrusted</option>
              <option value="2">2 ‚Äî Suspicious</option>
              <option value="3" selected>3 ‚Äî Neutral</option>
              <option value="4">4 ‚Äî Trusted</option>
              <option value="5">5 ‚Äî Fully Trusted</option>
            </select>
          </div>
          <div class="form-group">
            <label>Party Alignment</label>
            <select id="n-align">
              <option value="Unknown">Unknown</option>
              <option value="Ally">Ally</option>
              <option value="Neutral">Neutral</option>
              <option value="Rival">Rival</option>
              <option value="Threat">Threat</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>First Impression</label>
          <textarea id="n-impression" placeholder="How they came across when first met‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <label>What They Want</label>
          <textarea id="n-wants" placeholder="Their goals and motivations‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <label>Known Secrets</label>
          <textarea id="n-secrets" placeholder="What we know or suspect they're hiding‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <label>Promises Made / Debts Owed</label>
          <textarea id="n-debts" placeholder="Any agreements, favors, or obligations‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <label>Memorable Quotes</label>
          <textarea id="n-quotes" placeholder='"Never trust a smiling elf."'></textarea>
        </div>
        <div class="form-group">
          <label>Suspicious? Notes</label>
          <textarea id="n-suspicious" placeholder="Red flags, inconsistencies‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <label>Tags</label>
          <input type="text" id="n-tags" placeholder="#royalty, #cult, #fey">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-npc')">Cancel</button>
      <button class="btn btn-accent" onclick="saveNPC()">Save NPC</button>
    </div>
  </div>
</div>

<!-- CREATURE MODAL -->
<div class="modal-overlay" id="modal-creature">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="creature-modal-title">Add Creature</div>
      <button class="modal-close" onclick="closeModal('modal-creature')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-row">
          <div class="form-group">
            <label>Name / Type</label>
            <input type="text" id="cr-name" placeholder="Shadow Wraith">
          </div>
          <div class="form-group">
            <label>Where Encountered</label>
            <input type="text" id="cr-location" placeholder="Dungeon, 3rd level">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Disposition</label>
            <select id="cr-hostile">
              <option value="Hostile">Hostile</option>
              <option value="Neutral">Neutral</option>
              <option value="Friendly">Friendly</option>
            </select>
          </div>
          <div class="form-group">
            <label>Survived? (Party)</label>
            <select id="cr-survived">
              <option value="Yes">Yes</option>
              <option value="No ‚Äî total party kill">No ‚Äî TPK</option>
              <option value="Fled">Fled</option>
              <option value="Negotiated">Negotiated</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>Observed Abilities</label>
          <textarea id="cr-abilities" placeholder="What it did in combat ‚Äî spells, special moves‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <label>Weaknesses Discovered</label>
          <textarea id="cr-weaknesses" placeholder="Fire damage, sunlight, holy water‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <label>Tactical Notes</label>
          <textarea id="cr-tactics" placeholder="How to fight it next time‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <label>Outcome / Story Result</label>
          <textarea id="cr-outcome" placeholder="Killed, captured, it escaped‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <label>Tags</label>
          <input type="text" id="cr-tags" placeholder="#undead, #boss, #recurring">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-creature')">Cancel</button>
      <button class="btn btn-accent" onclick="saveCreature()">Save Creature</button>
    </div>
  </div>
</div>

<!-- LOCATION MODAL -->
<div class="modal-overlay" id="modal-location">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="location-modal-title">Add Location</div>
      <button class="modal-close" onclick="closeModal('modal-location')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-row">
          <div class="form-group">
            <label>Name</label>
            <input type="text" id="l-name" placeholder="Barovia Village">
          </div>
          <div class="form-group">
            <label>Mood / Atmosphere</label>
            <input type="text" id="l-mood" placeholder="Oppressive, foggy, medieval">
          </div>
        </div>
        <div class="form-group">
          <label>Description (as experienced)</label>
          <textarea id="l-desc" placeholder="What the party saw, heard, smelled‚Ä¶" style="min-height:80px"></textarea>
        </div>
        <div class="form-group">
          <label>Notable Residents</label>
          <textarea id="l-residents" placeholder="Who lives there, who rules it‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <label>Shops & Services</label>
          <textarea id="l-shops" placeholder="Blacksmith, tavern, temple, market‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <label>Rumors Heard Here</label>
          <textarea id="l-rumors" placeholder="What the locals say‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <label>Events That Happened Here</label>
          <textarea id="l-events" placeholder="Fights, discoveries, key scenes‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <label>What We Changed Here</label>
          <textarea id="l-changed" placeholder="Did we anger guards? Kill a noble? Start a revolution?"></textarea>
        </div>
        <div class="form-group">
          <label>Tags</label>
          <input type="text" id="l-tags" placeholder="#city, #dungeon, #cursed">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-location')">Cancel</button>
      <button class="btn btn-accent" onclick="saveLocation()">Save Location</button>
    </div>
  </div>
</div>

<!-- QUEST MODAL -->
<div class="modal-overlay" id="modal-quest">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="quest-modal-title">Add Quest</div>
      <button class="modal-close" onclick="closeModal('modal-quest')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-row">
          <div class="form-group">
            <label>Quest Title</label>
            <input type="text" id="q-title" placeholder="Find the Lost Crown">
          </div>
          <div class="form-group">
            <label>Type</label>
            <select id="q-type">
              <option value="Main Story">üß≠ Main Story</option>
              <option value="Side Quest">üåø Side Quest</option>
              <option value="Personal Goal">üßë Personal Goal</option>
              <option value="Mystery">üß© Long-Term Mystery</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Priority</label>
            <select id="q-priority">
              <option value="Critical">üî¥ Critical</option>
              <option value="High">üü† High</option>
              <option value="Medium" selected>üü° Medium</option>
              <option value="Low">üü¢ Low</option>
            </select>
          </div>
          <div class="form-group">
            <label>Risk Level</label>
            <select id="q-risk">
              <option value="Lethal">Lethal</option>
              <option value="Dangerous">Dangerous</option>
              <option value="Moderate" selected>Moderate</option>
              <option value="Safe">Safe</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>Objective ‚Äî What Are We Trying To Do?</label>
          <textarea id="q-objective" placeholder="Clear description of the goal‚Ä¶"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Quest Giver</label>
            <input type="text" id="q-giver" placeholder="Who gave it to us?">
          </div>
          <div class="form-group">
            <label>Reward</label>
            <input type="text" id="q-reward" placeholder="500gp, favor, info‚Ä¶">
          </div>
        </div>
        <div class="form-group">
          <label>Deadline (if known)</label>
          <input type="text" id="q-deadline" placeholder="Before the new moon‚Ä¶">
        </div>
        <div class="form-group">
          <label>Are We Actually Going To Do It?</label>
          <select id="q-intent">
            <option value="Yes">Yes ‚Äî on it</option>
            <option value="Maybe">Maybe</option>
            <option value="No">Probably not</option>
            <option value="Unknown">Unknown</option>
          </select>
        </div>
        <div class="form-group">
          <label>Status</label>
          <select id="q-status">
            <option value="Active">Active</option>
            <option value="Completed">Completed</option>
            <option value="Failed">Failed</option>
            <option value="On Hold">On Hold</option>
          </select>
        </div>
        <div class="form-group">
          <label>Tags</label>
          <input type="text" id="q-tags" placeholder="#artifact, #royalty">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-quest')">Cancel</button>
      <button class="btn btn-accent" onclick="saveQuest()">Save Quest</button>
    </div>
  </div>
</div>

<!-- INVENTORY ITEM MODAL -->
<div class="modal-overlay" id="modal-item">
  <div class="modal" style="max-width:480px">
    <div class="modal-header">
      <div class="modal-title" id="item-modal-title">Add Item</div>
      <button class="modal-close" onclick="closeModal('modal-item')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label>Item Name</label>
          <input type="text" id="i-name" placeholder="Potion of Healing">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Category</label>
            <select id="i-category">
              <option value="Potion">Potion</option>
              <option value="Weapon">Weapon</option>
              <option value="Armor">Armor</option>
              <option value="Scroll">Scroll</option>
              <option value="Quest Item">Quest Item</option>
              <option value="Gem / Treasure">Gem / Treasure</option>
              <option value="Currency">Currency</option>
              <option value="Misc">Misc</option>
            </select>
          </div>
          <div class="form-group">
            <label>Quantity</label>
            <input type="number" id="i-qty" value="1" min="1">
          </div>
        </div>
        <div class="form-group">
          <label>Carried By</label>
          <input type="text" id="i-carrier" placeholder="Party / specific character">
        </div>
        <div class="form-group">
          <label>Attuned By</label>
          <input type="text" id="i-attuned" placeholder="Character name (if attuned)">
        </div>
        <div class="form-group">
          <label>Notes</label>
          <textarea id="i-notes" placeholder="Description, effects, value‚Ä¶"></textarea>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-item')">Cancel</button>
      <button class="btn btn-accent" onclick="saveItem()">Save Item</button>
    </div>
  </div>
</div>

<!-- THEORY MODAL -->
<div class="modal-overlay" id="modal-theory">
  <div class="modal" style="max-width:520px">
    <div class="modal-header">
      <div class="modal-title" id="theory-modal-title">Add Theory</div>
      <button class="modal-close" onclick="closeModal('modal-theory')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label>Theory Title</label>
          <input type="text" id="th-title" placeholder="The Duke is the actual villain">
        </div>
        <div class="form-group">
          <label>Category</label>
          <select id="th-category">
            <option value="Villain Theory">Villain Theory</option>
            <option value="Identity">Secret Identity</option>
            <option value="Conspiracy">Conspiracy</option>
            <option value="Timeline">Timeline</option>
            <option value="Prophecy">Prophecy</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label>The Theory</label>
          <textarea id="th-theory" placeholder="Detail your speculation‚Ä¶" style="min-height:100px"></textarea>
        </div>
        <div class="form-group">
          <label>Supporting Evidence</label>
          <textarea id="th-evidence" placeholder="Facts, clues, and observations that support this‚Ä¶"></textarea>
        </div>
        <div class="form-group">
          <label>Confidence Level</label>
          <select id="th-confidence">
            <option value="Wild Guess">üé≤ Wild Guess</option>
            <option value="Plausible" selected>ü§î Plausible</option>
            <option value="Likely">üßê Likely</option>
            <option value="Almost Certain">üî• Almost Certain</option>
            <option value="Confirmed">‚úÖ Confirmed</option>
          </select>
        </div>
        <div class="form-group">
          <label>Tags</label>
          <input type="text" id="th-tags" placeholder="#villain, #cult, #royalty">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-theory')">Cancel</button>
      <button class="btn btn-accent" onclick="saveTheory()">Save Theory</button>
    </div>
  </div>
</div>

<!-- PARTY RELATIONSHIP MODAL -->
<div class="modal-overlay" id="modal-party">
  <div class="modal" style="max-width:480px">
    <div class="modal-header">
      <div class="modal-title" id="party-modal-title">Add Relationship</div>
      <button class="modal-close" onclick="closeModal('modal-party')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-row">
          <div class="form-group">
            <label>Character A</label>
            <input type="text" id="p-char-a" placeholder="Gimli">
          </div>
          <div class="form-group">
            <label>Character B</label>
            <input type="text" id="p-char-b" placeholder="Legolas">
          </div>
        </div>
        <div class="form-group">
          <label>Relationship Type</label>
          <select id="p-type">
            <option value="Bond">üíõ Bond / Friendship</option>
            <option value="Rivalry">‚ö° Rivalry</option>
            <option value="Romance">‚ù§Ô∏è Romance</option>
            <option value="Conflict">üî• Conflict</option>
            <option value="Debt">üí∞ Debt / Obligation</option>
            <option value="Secret">ü§´ Shared Secret</option>
            <option value="Mentor">üìö Mentor / Student</option>
          </select>
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea id="p-desc" placeholder="How did this relationship form? Where does it stand now?"></textarea>
        </div>
        <div class="form-group">
          <label>Shared Secrets / Tensions</label>
          <textarea id="p-secrets" placeholder="What does one know that the other doesn't?"></textarea>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-party')">Cancel</button>
      <button class="btn btn-accent" onclick="saveParty()">Save Relationship</button>
    </div>
  </div>
</div>

<!-- MEMORY MODAL -->
<div class="modal-overlay" id="modal-memory">
  <div class="modal" style="max-width:480px">
    <div class="modal-header">
      <div class="modal-title" id="memory-modal-title">Add Memory</div>
      <button class="modal-close" onclick="closeModal('modal-memory')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label>Type</label>
          <select id="m-type">
            <option value="Quote">üí¨ Funny Quote</option>
            <option value="Combat">‚öîÔ∏è Iconic Combat Moment</option>
            <option value="Inside Joke">üòÇ Inside Joke</option>
            <option value="Death Save">üíÄ Death Save</option>
            <option value="Critical Hit">üéØ Critical Hit</option>
            <option value="Achievement">üèÜ Achievement</option>
            <option value="Other">‚ú® Other</option>
          </select>
        </div>
        <div class="form-group">
          <label>Title / Label</label>
          <input type="text" id="m-title" placeholder="The Great Goblin Fumble">
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea id="m-desc" placeholder="Tell the story‚Ä¶"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Attributed To</label>
            <input type="text" id="m-attr" placeholder="Character or player name">
          </div>
          <div class="form-group">
            <label>Session #</label>
            <input type="number" id="m-session" placeholder="5" min="1">
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-memory')">Cancel</button>
      <button class="btn btn-accent" onclick="saveMemory()">Save Memory</button>
    </div>
  </div>
</div>

<!-- REPUTATION MODAL -->
<div class="modal-overlay" id="modal-reputation">
  <div class="modal" style="max-width:480px">
    <div class="modal-header">
      <div class="modal-title" id="rep-modal-title">Add Faction</div>
      <button class="modal-close" onclick="closeModal('modal-reputation')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label>Faction Name</label>
          <input type="text" id="r-name" placeholder="The Order of the Radiant Sun">
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea id="r-desc" placeholder="Who are they? What do they want?"></textarea>
        </div>
        <div class="form-group">
          <label>Reputation Score (0‚Äì100)</label>
          <input type="number" id="r-score" value="50" min="0" max="100">
        </div>
        <div class="form-group">
          <label>Notes on Current Standing</label>
          <textarea id="r-notes" placeholder="What happened to change our standing‚Ä¶"></textarea>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-reputation')">Cancel</button>
      <button class="btn btn-accent" onclick="saveReputation()">Save Faction</button>
    </div>
  </div>
</div>

<!-- DETAIL VIEW MODAL -->
<div class="modal-overlay" id="modal-detail">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="detail-modal-title">Detail</div>
      <button class="modal-close" onclick="closeModal('modal-detail')">√ó</button>
    </div>
    <div class="modal-body" id="detail-modal-body"></div>
    <div class="modal-footer" id="detail-modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-detail')">Close</button>
    </div>
  </div>
</div>
<script type="module">
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GITHUB API LAYER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

import { t1 } from './setting1.js';
import { t2 } from './setting2.js';
const encodedToken = t1 + t2;

let GH = {
  owner: 'teituroli',
  repo: 'chronicles',
  branch: 'main',
  token: encodedToken
};

function setStatus(state, text) {
  const dot = document.getElementById('sync-dot');
  const txt = document.getElementById('sync-text');
  dot.className = 'status-dot ' + state;
  txt.textContent = text;
}

async function ghGet(path) {
  const res = await fetch(`https://api.github.com/repos/${GH.owner}/${GH.repo}/contents/${path}`, {
    headers: { Authorization: `token ${GH.token}`, Accept: 'application/vnd.github.v3+json' }
  });
  return res;
}

async function ghPut(path, content, message, sha = null) {
  const body = { message, content: btoa(unescape(encodeURIComponent(content))), branch: GH.branch };
  if (sha) body.sha = sha;
  return fetch(`https://api.github.com/repos/${GH.owner}/${GH.repo}/contents/${path}`, {
    method: 'PUT',
    headers: {
      Authorization: `token ${GH.token}`,
      Accept: 'application/vnd.github.v3+json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(body)
  });
}

async function ghDelete(path, sha, message) {
  return fetch(`https://api.github.com/repos/${GH.owner}/${GH.repo}/contents/${path}`, {
    method: 'DELETE',
    headers: {
      Authorization: `token ${GH.token}`,
      Accept: 'application/vnd.github.v3+json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ message, sha, branch: GH.branch })
  });
}

async function readJSON(path) {
  try {
    const res = await ghGet(path);
    if (!res.ok) return { data: null, sha: null };
    const json = await res.json();
    const data = JSON.parse(atob(json.content.replace(/\n/g, '')));
    return { data, sha: json.sha };
  } catch {
    return { data: null, sha: null };
  }
}

async function writeJSON(path, data, message) {
  setStatus('loading', 'Saving‚Ä¶');
  try {
    const { sha } = await readJSON(path);
    const res = await ghPut(path, JSON.stringify(data, null, 2), message, sha);
    if (res.ok) {
      setStatus('ok', 'Saved');
      setTimeout(() => setStatus('ok', 'Connected'), 2000);
    } else {
      const err = await res.json();
      setStatus('err', 'Save failed: ' + (err.message || res.status));
    }
    return res.ok;
  } catch (e) {
    setStatus('err', 'Error: ' + e.message);
    return false;
  }
}

// ‚îÄ‚îÄ NEW HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function listDir(path) {
  try {
    const res = await ghGet(path);
    if (res.status === 404 || !res.ok) return [];
    const data = await res.json();
    return Array.isArray(data) ? data : [];
  } catch {
    return [];
  }
}

function slugify(text) {
  return text
    .toString()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .toLowerCase()
    .trim()
    .replace(/\s+/g, '-')
    .replace(/[^\w\-]+/g, '')
    .replace(/\-\-+/g, '-')
    .replace(/^-+/, '')
    .replace(/-+$/, '');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

let state = {
  campaigns: [],
  currentCampaign: null,
  data: {
    sessions: [], npcs: [], creatures: [], locations: [], quests: [],
    inventory: [], theories: [], party: [], memory: [], reputation: []
  }
};

let editingId = {};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SETTINGS / INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function loadSettings() {
  const saved = localStorage.getItem('chronicle_gh');
  if (saved) {
    GH = JSON.parse(saved);
    document.getElementById('s-owner').value = GH.owner || '';
    document.getElementById('s-repo').value = GH.repo || '';
    document.getElementById('s-branch').value = GH.branch || 'main';
    document.getElementById('s-token').value = GH.token || '';
  }
}

async function saveSettings() {
  GH.owner = document.getElementById('s-owner').value.trim();
  GH.repo = document.getElementById('s-repo').value.trim();
  GH.branch = document.getElementById('s-branch').value.trim() || 'main';
  GH.token = document.getElementById('s-token').value.trim();
  localStorage.setItem('chronicle_gh', JSON.stringify(GH));
  setStatus('loading', 'Testing‚Ä¶');

  if (!GH.owner || !GH.repo || !GH.token) {
    setStatus('err', 'Fill all fields');
    return;
  }

  const res = await fetch(`https://api.github.com/repos/${GH.owner}/${GH.repo}`, {
    headers: { Authorization: `token ${GH.token}` }
  });
  if (res.ok) {
    setStatus('ok', 'Connected');
    await loadCampaigns();
  } else {
    setStatus('err', 'Cannot reach repo');
  }
}

async function forceSyncAll() {
  await loadCampaigns();
  if (state.currentCampaign) await loadCampaignData(state.currentCampaign);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CAMPAIGNS (NEW IMPLEMENTATION)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function loadCampaigns() {
  if (!GH.owner || !GH.repo || !GH.token) return;
  setStatus('loading', 'Loading campaigns‚Ä¶');

  state.campaigns = [];

  // 1. Discover from actual folders (preferred new way)
  const dirItems = await listDir('campaigns');
  for (const item of dirItems.filter(i => i.type === 'dir')) {
    const folder = item.name;
    const metaRes = await readJSON(`campaigns/${folder}/meta.json`);
    let meta = metaRes.data;

    if (meta) {
      state.campaigns.push({
        id: folder,
        name: meta.name || folder,
        system: meta.system || '',
        party: meta.party || '',
        desc: meta.desc || '',
        created: meta.created || ''
      });
      continue;
    }

    // 2. Fallback for old c_ folders ‚Üí look up name in campaigns.json
    const oldRes = await readJSON('campaigns.json');
    const oldList = oldRes.data || [];
    const oldCamp = oldList.find(c => c.id === folder);
    if (oldCamp) {
      state.campaigns.push({ ...oldCamp });
    } else {
      state.campaigns.push({
        id: folder,
        name: folder,
        system: '', party: '', desc: '', created: ''
      });
    }
  }

  // 3. Ultimate fallback if no folders exist yet
  if (state.campaigns.length === 0) {
    const oldRes = await readJSON('campaigns.json');
    if (oldRes.data && oldRes.data.length) {
      state.campaigns = oldRes.data.map(c => ({...c}));
    }
  }

  // Sort newest first
  state.campaigns.sort((a, b) => {
    const da = a.created ? new Date(a.created) : new Date(0);
    const db = b.created ? new Date(b.created) : new Date(0);
    return db - da;
  });

  renderCampaignSelect();
  setStatus('ok', 'Connected');

  // Auto-select last used or first campaign
  const lastId = localStorage.getItem('chronicle_last_campaign');
  const toSelect = lastId && state.campaigns.find(c => c.id === lastId)
    ? lastId
    : (state.campaigns[0] ? state.campaigns[0].id : null);

  if (toSelect) {
    document.getElementById('campaign-select').value = toSelect;
    await selectCampaign(toSelect);
  } else {
    document.getElementById('no-campaign').style.display = 'flex';
  }
}

function renderCampaignSelect() {
  const sel = document.getElementById('campaign-select');
  sel.innerHTML = '<option value="">‚Äî Select Campaign ‚Äî</option>';
  state.campaigns.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c.id;
    opt.textContent = c.name + (c.system ? ` (${c.system})` : '');
    sel.appendChild(opt);
  });
  if (state.currentCampaign) sel.value = state.currentCampaign;
}

document.getElementById('campaign-select').addEventListener('change', async function() {
  if (this.value) await selectCampaign(this.value);
  else {
    state.currentCampaign = null;
    document.getElementById('no-campaign').style.display = 'flex';
    document.getElementById('main').querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  }
});

async function selectCampaign(id) {
  state.currentCampaign = id;
  localStorage.setItem('chronicle_last_campaign', id);
  document.getElementById('no-campaign').style.display = 'none';
  document.getElementById('campaign-select').value = id;
  await loadCampaignData(id);
  showPage(document.querySelector('.nav-item.active')?.dataset.page || 'sessions');
}

async function loadCampaignData(id) {
  setStatus('loading', 'Loading campaign‚Ä¶');
  const keys = ['sessions','npcs','creatures','locations','quests','inventory','theories','party','memory','reputation'];
  for (const key of keys) {
    const { data } = await readJSON(`campaigns/${id}/${key}.json`);
    state.data[key] = data || [];
  }
  renderAll();
  setStatus('ok', 'Connected');
}

function openNewCampaignModal() {
  document.getElementById('c-name').value = '';
  document.getElementById('c-system').value = '';
  document.getElementById('c-party').value = '';
  document.getElementById('c-desc').value = '';
  openModal('modal-campaign');
}

async function createCampaign() {
  const name = document.getElementById('c-name').value.trim();
  if (!name) return alert('Campaign name required');

  let slug = slugify(name);

  // Avoid collision
  let exists = false;
  try {
    const check = await ghGet(`campaigns/${slug}`);
    if (check.ok) {
      const items = await check.json();
      if (Array.isArray(items) && items.length > 0) exists = true;
    }
  } catch {}

  if (exists) slug += '-' + Date.now().toString(36).slice(-4);

  const campaignMeta = {
    name,
    system: document.getElementById('c-system').value.trim(),
    party: document.getElementById('c-party').value.trim(),
    desc: document.getElementById('c-desc').value.trim(),
    created: new Date().toISOString()
  };

  await writeJSON(`campaigns/${slug}/meta.json`, campaignMeta, `Create campaign: ${name}`);

  const keys = ['sessions','npcs','creatures','locations','quests','inventory','theories','party','memory','reputation'];
  for (const key of keys) {
    await writeJSON(`campaigns/${slug}/${key}.json`, [], `Init ${key} for ${name}`);
  }

  await loadCampaigns();
  closeModal('modal-campaign');
  await selectCampaign(slug);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  (the rest of your original script stays exactly the same)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function showPage(name) { /* unchanged */ }
function openModal(id) { /* unchanged */ }
function closeModal(id) { /* unchanged */ }

function uid() { return 'id_' + Date.now() + '_' + Math.random().toString(36).slice(2, 7); }
async function saveData(key) { /* unchanged */ }
function renderAll() { /* unchanged */ }
function tagsHTML(tags) { /* unchanged */ }
function trustStars(n) { /* unchanged */ }
function emptyState(icon, title, sub, btnLabel, btnFn) { /* unchanged */ }

// All the page-specific functions (sessions, npcs, creatures, ‚Ä¶) are unchanged
// ‚Ä¶ (copy everything from your original file starting from "SESSIONS" down to the end)

Object.assign(window, {
  showPage, openModal, closeModal, openNewCampaignModal, createCampaign,
  saveSettings, forceSyncAll, openSessionModal, saveSession, viewSession, deleteSession,
  openNPCModal, saveNPC, deleteNPC, openCreatureModal, saveCreature, deleteCreature,
  openLocationModal, saveLocation, deleteLocation, openQuestModal, saveQuest, deleteQuest,
  openItemModal, saveItem, openPartyModal, saveParty, openTheoryModal, saveTheory,
  openMemoryModal, saveMemory, openReputationModal, saveReputation,
});
</script>